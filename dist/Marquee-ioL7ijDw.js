import{A as y}from"./app.js";import g from"./VideoLoader-DY3BupWB.js";const m=d=>{const i=d.querySelectorAll("img"),o=[...i].map(e=>{const a=e.getAttribute("src");return e.removeAttribute("srcset"),e.removeAttribute("src"),e.removeAttribute("loading"),a});let r=!1;ScrollTrigger.create({trigger:d,start:"top bottom+=150%",onEnter:()=>{r||(i.forEach((e,a)=>{const t=o[a];e.setAttribute("src",t)}),r=!0)}})},h=y.getInstance();class k{constructor(i,o){var a;if(this.instance=i,this.main=o,this.scroll=h.scroll.lenis,this.observer=h.observer.instance,this.destroyed=!1,(a=this.instance.parentElement)!=null&&a.classList.contains("w-condition-invisible"))return;this.axis=this.instance.dataset.axis==="vertical"?"y":"x",this.multiDirection=this.instance.dataset.direction==="1"?1:-1,this.direction=1*this.multiDirection,this.prevDirection=this.direction,this.velocity={value:0},this.enter={value:1},this.move=0,this.draggableMove={value:0},this.draggableVelocity=0,this.proxy=document.createElement("div"),this.props=gsap.getProperty(this.proxy),this.wrappers=this.instance.querySelectorAll("[wrapper]"),this.items=this.instance.querySelectorAll("[item]");const e=this.wrappers.length;this.numberOfItems=this.items.length/e,this.wrapperOffset=this.axis==="x"?this.wrappers[0].getBoundingClientRect().width:this.wrappers[0].getBoundingClientRect().height,this.duplicateMarqueeWrappers(),this.setupCardVisibility(),this.partLength=this.items.length/this.wrappers.length,this.axis==="y"?this.newOrderItems=Array.from(this.items):this.newOrderItems=[...Array.from(this.items).slice(this.partLength/2),...Array.from(this.items).slice(0,this.partLength/2)],m(this.instance),this.quicks=[...this.wrappers].map(t=>gsap.quickSetter(t,this.axis,"%")),this.draggbleQuick=gsap.quickTo(this.draggableMove,"value",{duration:.2,ease:"power1.out"}),this.changeVelocity=gsap.quickTo(this.velocity,"value",{duration:.2,ease:"power1.out"}),this.scroll.on("scroll",t=>{this.destroyed||this.instance.dataset.visible=="false"||(this.changeVelocity(Math.abs(t.velocity)),this.prevDirection!==t.direction&&(this.direction=t.direction*this.multiDirection,this.prevDirection=t.direction))}),this.initDraggable(),this.observer.observe(this.instance),this.wrappers.forEach(t=>{t.addEventListener("mouseenter",()=>{var s;(s=this.enterTl)==null||s.kill(),this.enterTl=gsap.to(this.enter,{value:0,duration:.6,ease:"power1.out"})}),t.addEventListener("mouseleave",()=>{var s;(s=this.enterTl)==null||s.kill(),this.enterTl=gsap.to(this.enter,{value:1,duration:.6,ease:"power1.out"})})}),this.revealed=!1,this.revealTl=gsap.timeline({paused:!0,defaults:{duration:1,ease:"power1.out"}}),gsap.set(this.newOrderItems,{transformOrigin:"bottom"}),this.revealTl.fromTo(this.newOrderItems,{yPercent:40,rotateY:12,rotateX:45,opacity:0},{yPercent:0,rotateY:0,rotateX:0,opacity:1,stagger:.08,onComplete:()=>this.revealed=!0}),this.scrollTrigger=ScrollTrigger.create({trigger:this.wrappers[0],start:"top 80%",onEnter:()=>{this.revealed||this.revealTl.play()}}),h.on("tick",()=>this.tick()),h.on("resize",()=>this.resize()),h.on("destroy",()=>this.destroy())}duplicateMarqueeWrappers(){this.instance.querySelectorAll("[data-duplicate]").forEach(o=>{const r=o.parentNode;for(let e=0;e<2;e++){const a=o.cloneNode(!0);r.appendChild(a)}}),this.wrappers=this.instance.querySelectorAll("[wrapper]"),this.items=this.instance.querySelectorAll("[item]")}initDraggable(){this.draggable=Draggable.create(this.proxy,{type:this.axis,inertia:!0,trigger:this.instance,onDrag:()=>{if(this.destroyed)return;const i=this.axis==="y"?this.draggable[0].deltaY:this.draggable[0].deltaX;this.draggbleQuick(i)},onThrowUpdate:()=>{if(this.destroyed)return;const i=this.axis==="y"?this.draggable[0].deltaY:this.draggable[0].deltaX;this.draggbleQuick(i)}})}tick(){if(this.destroyed||this.instance.dataset.visible=="false")return;this.quicks.forEach(e=>e(this.move));const i=gsap.utils.mapRange(0,100,0,1,this.velocity.value);this.move;const r=.1-this.wrapperOffset/window.innerWidth/1e3;this.move+=this.direction*(r+i)*this.enter.value+this.draggableMove.value/10,this.draggbleQuick(0),(this.move>100||this.move<-100)&&(this.move=0),this.changeVelocity(0)}resize(){this.destroyed}setupCardVisibility(){this.items.forEach(i=>{const o=window.innerWidth<=992,r=i.querySelector(".s-card_image"),e=i.querySelector(".s-card_video");if(r&&e){const t=e.querySelector("video"),s=e.querySelector("source");if(s&&t){const l=s.getAttribute("data-src-mobile"),n=s.getAttribute("data-src"),c=o&&l?l:n;c&&c.trim()!==""?(r.style.display="none",e.style.display="block",new g(t).on("error",()=>{r.style.display="block",e.style.display="none"})):(r.style.display="block",e.style.display="none")}}if(i.querySelector(".s-gallery_item_wrapper")){const t=i.querySelector(".s-gallery_item_image"),s=i.querySelector(".s-gallery_item_video");if(t&&s){const l=s.querySelector("video"),n=l==null?void 0:l.querySelector("source");if(n&&l){const c=n.getAttribute("data-src-mobile"),u=n.getAttribute("data-src"),p=o&&c?c:u;p&&p.trim()!==""?(t.style.display="none",s.style.display="block",new g(l).on("error",()=>{console.warn("Gallery video failed to load, falling back to image"),t.style.display="block",s.style.display="none"})):(t.style.display="block",s.style.display="none")}}}})}destroy(){this.destroyed||(this.destroyed=!0)}}export{k as default};
