class c{constructor(e,i){this.instance=e,this.app=i,this.destroyed=!1,this.calLoaded=!1,this.calNamespace=this.generateNamespace(),this.calendarId=`my-cal-inline-${Math.random().toString(36).substr(2,9)}`,this.lastHeight=0,this.heightObserver=null,this.config=this.getConfigFromAttributes(),this.init(),this.app.on("destroy",()=>this.destroy()),this.app.on("resize",()=>this.resize()),this.app.on("pageEnter",()=>this.onPageTransition()),this.app.on("pageReady",()=>this.onPageTransition())}generateNamespace(){return`cal_${Math.random().toString(36).substr(2,9)}`}getConfigFromAttributes(){return{calLink:this.instance.dataset.calLink||"skvarenina/30min",theme:this.instance.dataset.theme||"dark",layout:this.instance.dataset.layout||"month_view",hideEventTypeDetails:this.instance.dataset.hideEventTypeDetails!=="true"}}init(){this.createCalendarContainer(),this.loadCalScript()}createCalendarContainer(){this.instance.innerHTML="",this.calendarDiv=document.createElement("div"),this.calendarDiv.id=this.calendarId,this.calendarDiv.style.width="100%",this.calendarDiv.style.height=window.innerWidth<992?"auto":"100%",this.calendarDiv.style.scrollbarWidth="none",this.instance.appendChild(this.calendarDiv)}loadCalScript(){if(window.Cal){this.initCalendar();return}if(window.calScriptLoading){const n=()=>{window.Cal?this.initCalendar():setTimeout(n,100)};n();return}if(window.calScriptLoading=!0,document.querySelector('script[src*="cal.com/embed/embed.js"]')){this.initCalendar();return}this.initCalLoader();const i=()=>{window.Cal?(window.calScriptLoading=!1,this.initCalendar()):setTimeout(i,100)};i()}initCalLoader(){window.Cal||(function(e,i,n){let s=function(t,a){t.q.push(a)},h=e.document;e.Cal=e.Cal||function(){let t=e.Cal,a=arguments;if(t.loaded||(t.ns={},t.q=t.q||[],h.head.appendChild(h.createElement("script")).src=i,t.loaded=!0),a[0]===n){const o=function(){s(o,arguments)},r=a[1];o.q=o.q||[],typeof r=="string"?(t.ns[r]=t.ns[r]||o,s(t.ns[r],a),s(t,["initNamespace",r])):s(t,a);return}s(t,a)}})(window,"https://app.cal.com/embed/embed.js","init")}initCalendar(){if(!window.Cal){console.error("Cal.com script not loaded");return}if(!this.destroyed)try{window.Cal("init",this.calNamespace,{origin:"https://cal.com"}),setTimeout(()=>{this.destroyed||(window.Cal.ns[this.calNamespace]("inline",{elementOrSelector:`#${this.calendarId}`,config:{layout:this.config.layout,theme:this.config.theme},calLink:this.config.calLink}),window.Cal.ns[this.calNamespace]("ui",{theme:this.config.theme,hideEventTypeDetails:this.config.hideEventTypeDetails,layout:this.config.layout}),this.calInstance=window.Cal.ns[this.calNamespace],this.onCalendarLoaded())},200)}catch(e){console.error("Error initializing Cal.com calendar:",e)}}onCalendarLoaded(){this.startHeightMonitoring(),setTimeout(()=>ScrollTrigger.refresh(),100)}startHeightMonitoring(){!this.calendarDiv||this.destroyed||(window.ResizeObserver?(this.heightObserver=new ResizeObserver(e=>{for(let i of e){const n=i.contentRect.height;Math.abs(n-this.lastHeight)>50&&(this.lastHeight=n,setTimeout(()=>{this.destroyed||ScrollTrigger.refresh()},300))}}),this.heightObserver.observe(this.calendarDiv)):this.heightPolling=setInterval(()=>{if(this.destroyed)return;const e=this.calendarDiv.offsetHeight;Math.abs(e-this.lastHeight)>50&&(this.lastHeight=e,ScrollTrigger.refresh())},1e3))}stopHeightMonitoring(){this.heightObserver&&(this.heightObserver.disconnect(),this.heightObserver=null),this.heightPolling&&(clearInterval(this.heightPolling),this.heightPolling=null)}onPageTransition(){this.destroyed||setTimeout(()=>{!this.destroyed&&this.calInstance&&ScrollTrigger.refresh()},500)}updateConfig(e){if(!this.calInstance){console.warn("Calendar not initialized yet");return}try{this.calInstance("ui",e)}catch(i){console.error("Error updating calendar config:",i)}}setTheme(e="dark"){this.config.theme=e,this.updateConfig({theme:e,hideEventTypeDetails:this.config.hideEventTypeDetails,layout:this.config.layout,scrollbarWidth:"none"})}resize(){this.destroyed||!this.calInstance||setTimeout(()=>{if(this.calInstance&&!this.destroyed)try{this.calInstance("ui",{theme:this.config.theme,hideEventTypeDetails:this.config.hideEventTypeDetails,layout:this.config.layout,scrollbarWidth:"none"})}catch(e){console.error("Error resizing calendar:",e)}},100)}destroy(){if(!this.destroyed){if(this.destroyed=!0,this.stopHeightMonitoring(),this.calendarDiv&&(this.calendarDiv.innerHTML=""),window.Cal&&window.Cal.ns&&window.Cal.ns[this.calNamespace])try{delete window.Cal.ns[this.calNamespace]}catch(e){console.warn("Could not clean up Cal.com namespace:",e)}this.calInstance=null}}}export{c as default};
