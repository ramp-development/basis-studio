import{g as s}from"./all-Cn1KrK_M.js";import{S as p}from"./SplitText-n_eiQhs4.js";import{S as d}from"./ScrollTrigger-BWsqEc1I.js";import"./CSSPlugin-YLlZY2Jb.js";s.registerPlugin(p,d);class v{constructor(t,i){this.instance=t,this.app=i,this.title=this.instance.querySelector(".talk_title"),this.list=this.instance.querySelector(".talk_item"),this.items=this.list.querySelectorAll(".f-96"),this.destroyed=!1,this.titleHidden=!1,this.init(),this.app.on("resize",()=>this.resize()),this.app.on("destroy",()=>this.destroy())}init(){this.split=new p(this.title,{type:"lines"}),this.splitSecond=new p(this.title,{type:"lines"}),s.set(this.splitSecond.lines,{overflow:"clip",paddingBottom:"0.1em",marginBottom:"-0.1em",perspective:1e3}),this.calculatePositions(),this.setupTitleAnimation(),this.setupScrollAnimation()}calculatePositions(){const t=Math.min(window.innerWidth,window.innerHeight)*.4,i=16;this.items.forEach((a,r)=>{const l=r*i*(Math.PI/180),h=r*-i,c=0,o=Math.sin(l)*t,n=Math.cos(l)*t;a.style.transform=`translate3d(-50%, -50%, 0) translate3d(${c}px, ${o}px, ${n}px) rotateX(${h}deg)`})}setupTitleAnimation(){this.titleTl=s.timeline({paused:!0,defaults:{duration:.8,ease:"power3.out"}}),this.titleTl.fromTo(this.split.lines,{y:"120%",rotateX:"-65deg",transformStyle:"preserve-3d",transformOrigin:"center bottom"},{y:"0%",rotateX:"0deg",stagger:.1}),this.titleScrollTrigger=d.create({trigger:this.title,start:"top 85%",onEnter:()=>this.titleTl.play(),onLeaveBack:()=>this.titleTl.reverse(),onEnterBack:()=>this.titleTl.play()})}setupScrollAnimation(){this.scrollTrigger=d.create({trigger:this.title,start:"center center",end:"+=1850vh",pin:this.instance,scrub:2,animation:s.fromTo(this.list,{rotateX:-80},{rotateX:270,ease:"none"}),onUpdate:t=>{var o,n,g;t.progress>.001&&!this.titleHidden?(this.hideTitleAnimation(),this.titleHidden=!0):t.progress<=.001&&this.titleHidden&&(this.showTitleAnimation(),this.titleHidden=!1);const i=Math.max(0,t.progress-.1),a=t.progress,r=1-i*.8,l=1-a*.7,h=Math.max(.2,r),c=Math.max(.3,l);if(window.innerWidth>=991)(g=(n=(o=this.app.gl)==null?void 0:o.world)==null?void 0:n.video)!=null&&g.meshs&&this.app.gl.world.video.meshs.forEach((e,T)=>{var m,u,f;(m=e.item)!=null&&m.classList.contains("talk_full")&&(f=(u=e.material)==null?void 0:u.uniforms)!=null&&f.uAlpha&&(e.material.uniforms.uAlpha.value=c)});else{const e=document.querySelector(".talk_full");e&&(e.style.opacity=h)}}}),this.list.style.pointerEvents="none"}hideTitleAnimation(){s.to(this.split.lines,{y:"-120%",rotateX:"65deg",duration:.6,ease:"power3.in"})}showTitleAnimation(){s.to(this.split.lines,{y:"0%",rotateX:"0deg",duration:.6,ease:"power3.out",stagger:.05})}resize(){this.destroyed||(this.calculatePositions(),this.scrollTrigger&&(this.scrollTrigger.kill(),this.setupScrollAnimation()))}destroy(){this.destroyed||(this.destroyed=!0,this.titleScrollTrigger&&this.titleScrollTrigger.kill(),this.scrollTrigger&&this.scrollTrigger.kill(),this.titleSplit&&this.titleSplit.revert())}}export{v as default};
