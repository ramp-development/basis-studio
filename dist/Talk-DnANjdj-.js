import{A as u}from"./app.js";const n=u.getInstance();class S{constructor(t){this.instance=t,this.title=this.instance.querySelector(".talk_title"),this.list=this.instance.querySelector(".talk_item"),this.items=this.list.querySelectorAll(".f-96"),this.destroyed=!1,this.titleHidden=!1,this.init(),n.on("resize",()=>this.resize()),n.on("destroy",()=>this.destroy())}init(){this.split=new SplitText(this.title,{type:"lines",mask:"lines"}),gsap.set(this.split.lines,{paddingBottom:"0.1em",marginBottom:"-0.1em",perspective:1e3}),this.calculatePositions(),this.setupTitleAnimation(),this.setupScrollAnimation()}calculatePositions(){const t=Math.min(window.innerWidth,window.innerHeight)*.4,e=16;this.items.forEach((a,s)=>{const r=s*e*(Math.PI/180),h=s*-e,c=0,l=Math.sin(r)*t,o=Math.cos(r)*t;a.style.transform=`translate3d(-50%, -50%, 0) translate3d(${c}px, ${l}px, ${o}px) rotateX(${h}deg)`})}setupTitleAnimation(){this.titleTl=gsap.timeline({paused:!0,defaults:{duration:.8,ease:"power3.out"}}),this.titleTl.fromTo(this.split.lines,{yPercent:120,rotateX:"-65deg",transformStyle:"preserve-3d",transformOrigin:"center bottom"},{yPercent:0,rotateX:"0deg",stagger:.1}),this.titleScrollTrigger=ScrollTrigger.create({trigger:this.title,start:"top 85%",onEnter:()=>this.titleTl.play(),onLeaveBack:()=>this.titleTl.reverse(),onEnterBack:()=>this.titleTl.play()})}setupScrollAnimation(){this.scrollTrigger=ScrollTrigger.create({trigger:this.title,start:"center center",end:"+=1850vh",pin:this.instance,scrub:2,animation:gsap.fromTo(this.list,{rotateX:-80},{rotateX:270,ease:"none"}),onUpdate:t=>{var l,o,p;t.progress>.001&&!this.titleHidden?(this.hideTitleAnimation(),this.titleHidden=!0):t.progress<=.001&&this.titleHidden&&(this.showTitleAnimation(),this.titleHidden=!1);const e=Math.max(0,t.progress-.1),a=t.progress,s=1-e*.8,r=1-a*.7,h=Math.max(.2,s),c=Math.max(.3,r);if(window.innerWidth>=991)(p=(o=(l=n.gl)==null?void 0:l.world)==null?void 0:o.video)!=null&&p.meshs&&n.gl.world.video.meshs.forEach((i,y)=>{var d,g,m;(d=i.item)!=null&&d.classList.contains("talk_full")&&(m=(g=i.material)==null?void 0:g.uniforms)!=null&&m.uAlpha&&(i.material.uniforms.uAlpha.value=c)});else{const i=document.querySelector(".talk_full");i&&(i.style.opacity=h)}}}),this.list.style.pointerEvents="none"}hideTitleAnimation(){gsap.to(this.split.lines,{yPercent:-120,rotateX:"65deg",duration:.6,ease:"power3.in"})}showTitleAnimation(){gsap.to(this.split.lines,{yPercent:0,rotateX:"0deg",duration:.6,ease:"power3.out",stagger:.05})}resize(){this.destroyed||(this.calculatePositions(),this.scrollTrigger&&(this.scrollTrigger.kill(),this.setupScrollAnimation()))}destroy(){this.destroyed||(this.destroyed=!0,this.titleScrollTrigger&&this.titleScrollTrigger.kill(),this.scrollTrigger&&this.scrollTrigger.kill(),this.titleSplit&&this.titleSplit.revert())}}export{S as default};
