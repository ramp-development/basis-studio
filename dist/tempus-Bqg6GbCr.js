var c=Object.defineProperty;var f=(t,e,i)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>f(t,typeof e!="symbol"?e+"":e,i);var d=class{constructor(){s(this,"_elapsed",0);s(this,"_currentTime",0);s(this,"_startTime");s(this,"_lastTime");s(this,"_isPlaying",!1);s(this,"_deltaTime",0)}play(){this._isPlaying||(this._currentTime=0,this._startTime=void 0,this._isPlaying=!0)}pause(){this._isPlaying&&(this._deltaTime=0,this._isPlaying=!1)}reset(){this._elapsed=0,this._deltaTime=0,this._currentTime=0,this._lastTime=void 0,this._isPlaying=!1}update(t){this._isPlaying&&(this._startTime||(this._startTime=t),this._lastTime===void 0?(this._lastTime=this._startTime,this._currentTime=0,this._deltaTime=0):(this._lastTime=this._currentTime,this._currentTime=t-this._startTime,this._deltaTime=this._currentTime-this._lastTime,this._elapsed+=this._deltaTime))}get time(){return this._elapsed}get isPlaying(){return this._isPlaying}get deltaTime(){return this._deltaTime}},p=0;function _(){return p++}var n=typeof window<"u",o=n&&window.requestAnimationFrame,m=n&&window.cancelAnimationFrame,T=class{constructor(t=Number.POSITIVE_INFINITY){s(this,"callbacks",[]);s(this,"fps");s(this,"time",0);s(this,"lastTickDate",performance.now());s(this,"framesCount",0);this.fps=t}get isRelativeFps(){return typeof this.fps=="string"&&this.fps.endsWith("%")}get maxFramesCount(){return this.isRelativeFps?Math.max(1,Math.round(100/Number(this.fps.replace("%","")))):1}get executionTime(){return this.isRelativeFps?0:1e3/this.fps}dispatch(t,e){var i,a,h;for(let r=0;r<this.callbacks.length;r++){const u=performance.now();(i=this.callbacks[r])==null||i.callback(t,e);const l=performance.now()-u;(a=this.callbacks[r].samples)==null||a.push(l),this.callbacks[r].samples=(h=this.callbacks[r].samples)==null?void 0:h.slice(-9)}}raf(t,e){if(this.time+=e,this.isRelativeFps)this.framesCount===0&&this.dispatch(t,e),this.framesCount++,this.framesCount%=this.maxFramesCount;else if(this.fps===Number.POSITIVE_INFINITY)this.dispatch(t,e);else if(this.time>=this.executionTime){this.time=this.time%this.executionTime;const i=t-this.lastTickDate;this.lastTickDate=t,this.dispatch(t,i)}}add({callback:t,priority:e,label:i}){if(typeof t!="function"){console.warn("Tempus.add: callback is not a function");return}const a=_();return this.callbacks.push({callback:t,priority:e,uid:a,label:i,samples:[]}),this.callbacks.sort((h,r)=>h.priority-r.priority),()=>this.remove(a)}remove(t){this.callbacks=this.callbacks.filter(({uid:e})=>t!==e)}},g=class{constructor(){s(this,"framerates",{});s(this,"clock",new d);s(this,"fps");s(this,"usage",0);s(this,"rafId");s(this,"raf",t=>{if(!n)return;this.clock.update(t);const e=this.clock.time,i=this.clock.deltaTime;this.fps=1e3/i;const a=performance.now();for(const r of Object.values(this.framerates))r.raf(e,i);const h=performance.now()-a;this.usage=h/i,this.rafId=requestAnimationFrame(this.raf)});n&&this.play()}restart(){this.rafId&&cancelAnimationFrame(this.rafId);for(const t of Object.values(this.framerates))t.framesCount=0,t.time=0,t.lastTickDate=performance.now();this.clock.reset(),this.play()}play(){!n||this.clock.isPlaying||(this.clock.play(),this.rafId=requestAnimationFrame(this.raf))}pause(){!n||!this.rafId||!this.clock.isPlaying||(cancelAnimationFrame(this.rafId),this.rafId=void 0,this.clock.pause())}get isPlaying(){return this.clock.isPlaying}add(t,{priority:e=0,fps:i=Number.POSITIVE_INFINITY,label:a=""}={}){if(n){if(typeof i=="number"||typeof i=="string"&&i.endsWith("%"))return this.framerates[i]||(this.framerates[i]=new T(i)),this.framerates[i].add({callback:t,priority:e,label:a});console.warn('Tempus.add: fps is not a number or a string ending with "%"')}}patch(){n&&(window.requestAnimationFrame=(t,{priority:e=0,fps:i=Number.POSITIVE_INFINITY}={})=>t===this.raf||!t.toString().includes("requestAnimationFrame(")?o(t):(t.__tempusPatched||(t.__tempusPatched=!0,t.__tempusUnsubscribe=this.add(t,{priority:e,fps:i,label:t.name})),t.__tempusUnsubscribe),window.cancelAnimationFrame=t=>{if(typeof t=="function"){t==null||t();return}return m(t)})}unpatch(){n&&(window.requestAnimationFrame=o,window.cancelAnimationFrame=m)}},w=new g;export{w as T};
