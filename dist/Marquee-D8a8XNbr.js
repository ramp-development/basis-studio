import u from"./VideoLoader-K1Zmm6xk.js";import"./app.js";const g=h=>{const i=h.querySelectorAll("img"),a=[...i].map(e=>{const l=e.getAttribute("src");return e.removeAttribute("srcset"),e.removeAttribute("src"),e.removeAttribute("loading"),l});let r=!1;ScrollTrigger.create({trigger:h,start:"top bottom+=150%",onEnter:()=>{r||(i.forEach((e,l)=>{const o=a[l];e.setAttribute("src",o)}),r=!0)}})};class f{constructor(i,a,r){var o;if(this.instance=i,this.app=a,this.main=r,this.scroll=this.app.scroll.lenis,this.observer=this.app.observer.instance,this.destroyed=!1,(o=this.instance.parentElement)!=null&&o.classList.contains("w-condition-invisible"))return;this.axis=this.instance.dataset.axis==="vertical"?"y":"x",this.multiDirection=this.instance.dataset.direction==="1"?1:-1,this.direction=1*this.multiDirection,this.prevDirection=this.direction,this.velocity={value:0},this.enter={value:1},this.move=0,this.draggableMove={value:0},this.draggableVelocity=0,this.proxy=document.createElement("div"),this.props=gsap.getProperty(this.proxy),this.wrappers=this.instance.querySelectorAll("[wrapper]"),this.items=this.instance.querySelectorAll("[item]");const l=this.wrappers.length;this.numberOfItems=this.items.length/l,this.wrapperOffset=this.axis==="x"?this.wrappers[0].getBoundingClientRect().width:this.wrappers[0].getBoundingClientRect().height,this.duplicateMarqueeWrappers(),this.setupCardVisibility(),this.partLength=this.items.length/this.wrappers.length,this.axis==="y"?this.newOrderItems=Array.from(this.items):this.newOrderItems=[...Array.from(this.items).slice(this.partLength/2),...Array.from(this.items).slice(0,this.partLength/2)],g(this.instance),this.quicks=[...this.wrappers].map(t=>gsap.quickSetter(t,this.axis,"%")),this.draggbleQuick=gsap.quickTo(this.draggableMove,"value",{duration:.2,ease:"power1.out"}),this.changeVelocity=gsap.quickTo(this.velocity,"value",{duration:.2,ease:"power1.out"}),this.scroll.on("scroll",t=>{this.destroyed||this.instance.dataset.visible=="false"||(this.changeVelocity(Math.abs(t.velocity)),this.prevDirection!==t.direction&&(this.direction=t.direction*this.multiDirection,this.prevDirection=t.direction))}),this.initDraggable(),this.observer.observe(this.instance),this.wrappers.forEach(t=>{t.addEventListener("mouseenter",()=>{var s;(s=this.enterTl)==null||s.kill(),this.enterTl=gsap.to(this.enter,{value:0,duration:.6,ease:"power1.out"})}),t.addEventListener("mouseleave",()=>{var s;(s=this.enterTl)==null||s.kill(),this.enterTl=gsap.to(this.enter,{value:1,duration:.6,ease:"power1.out"})})}),this.revealed=!1,this.revealTl=gsap.timeline({paused:!0,defaults:{duration:1,ease:"power1.out"}}),gsap.set(this.newOrderItems,{transformOrigin:"bottom"}),this.revealTl.fromTo(this.newOrderItems,{yPercent:40,rotateY:12,rotateX:45,opacity:0},{yPercent:0,rotateY:0,rotateX:0,opacity:1,stagger:.08,onComplete:()=>this.revealed=!0}),this.scrollTrigger=ScrollTrigger.create({trigger:this.wrappers[0],start:"top 80%",onEnter:()=>{this.revealed||this.revealTl.play()}}),this.app.on("tick",()=>this.tick()),this.app.on("resize",()=>this.resize()),this.app.on("destroy",()=>this.destroy())}duplicateMarqueeWrappers(){this.instance.querySelectorAll("[data-duplicate]").forEach(a=>{const r=a.parentNode;for(let e=0;e<2;e++){const l=a.cloneNode(!0);r.appendChild(l)}}),this.wrappers=this.instance.querySelectorAll("[wrapper]"),this.items=this.instance.querySelectorAll("[item]")}initDraggable(){this.draggable=Draggable.create(this.proxy,{type:this.axis,inertia:!0,trigger:this.instance,onDrag:()=>{if(this.destroyed)return;const i=this.axis==="y"?this.draggable[0].deltaY:this.draggable[0].deltaX;this.draggbleQuick(i)},onThrowUpdate:()=>{if(this.destroyed)return;const i=this.axis==="y"?this.draggable[0].deltaY:this.draggable[0].deltaX;this.draggbleQuick(i)}})}tick(){if(this.destroyed||this.instance.dataset.visible=="false")return;this.quicks.forEach(e=>e(this.move));const i=gsap.utils.mapRange(0,100,0,1,this.velocity.value);this.move;const r=.1-this.wrapperOffset/window.innerWidth/1e3;this.move+=this.direction*(r+i)*this.enter.value+this.draggableMove.value/10,this.draggbleQuick(0),(this.move>100||this.move<-100)&&(this.move=0),this.changeVelocity(0)}resize(){this.destroyed}setupCardVisibility(){this.items.forEach(i=>{const a=window.innerWidth<=992,r=i.querySelector(".s-card_image"),e=i.querySelector(".s-card_video");if(r&&e){const o=e.querySelector("video"),t=e.querySelector("source");if(t&&o){const s=t.getAttribute("data-src-mobile"),n=t.getAttribute("data-src"),c=a&&s?s:n;c&&c.trim()!==""?(r.style.display="none",e.style.display="block",new u(o).on("error",()=>{r.style.display="block",e.style.display="none"})):(r.style.display="block",e.style.display="none")}}if(i.querySelector(".s-gallery_item_wrapper")){const o=i.querySelector(".s-gallery_item_image"),t=i.querySelector(".s-gallery_item_video");if(o&&t){const s=t.querySelector("video"),n=s==null?void 0:s.querySelector("source");if(n&&s){const c=n.getAttribute("data-src-mobile"),p=n.getAttribute("data-src"),d=a&&c?c:p;d&&d.trim()!==""?(o.style.display="none",t.style.display="block",new u(s).on("error",()=>{console.warn("Gallery video failed to load, falling back to image"),o.style.display="block",t.style.display="none"})):(o.style.display="block",t.style.display="none")}}}})}destroy(){this.destroyed||(this.destroyed=!0)}}export{f as default};
